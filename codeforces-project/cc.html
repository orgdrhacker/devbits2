<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Contest - Codeforces Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
  <!-- Navigation Header -->
  <header class="bg-gray-800 p-4 shadow-lg w-full">
    <nav class="flex items-center">
      <div>
        <a href="index.html" class="text-2xl font-bold pl-4">Coderia</a>
      </div>
      <div class="flex ml-auto items-center space-x-6 pr-4">
        <a href="index.html" class="text-lg font-semibold hover:underline">HOME</a>
        <a href="profile.html" class="text-lg font-semibold hover:underline">PROFILE</a>
        <a href="contest_list.html" class="text-lg font-semibold hover:underline">CONTESTS</a>
        <a href="problemset.html" class="text-lg font-semibold hover:underline">PROBLEMSET</a>
      </div>
    </nav>
  </header>

  <!-- Main Container -->
  <main class="max-w-6xl mx-auto mt-8 bg-gray-800 p-6 rounded-lg shadow-lg">
    <h1 class="text-3xl font-bold text-center mb-4">Create Contest</h1>
    <p class="text-center text-gray-300 mb-6">
      Load problems from Codeforces and select the ones for your contest.
    </p>
    
    <!-- Button to load problems -->
    <div class="flex justify-end mb-4">
      <button id="loadProblemsBtn" class="bg-green-600 px-4 py-2 rounded text-white hover:bg-green-700">
        Load Problems
      </button>
    </div>
    
    <!-- Container for displaying problems -->
    <div id="problemsContainer" class="overflow-x-auto"></div>
    
    <!-- Create Contest Button -->
    <div class="flex justify-center mt-6">
      <button id="createContestBtn" class="bg-blue-600 px-6 py-2 rounded text-white hover:bg-blue-700">
        Create Contest
      </button>
    </div>
    
    <!-- Message area -->
    <p id="message" class="mt-4 text-center"></p>
  </main>

  <script>
    let problemSet = [];
    const selectedProblems = new Set();

    async function loadProblems() {
      const container = document.getElementById("problemsContainer");
      container.innerHTML = "Loading problems...";
      try {
        const response = await fetch("https://codeforces.com/api/problemset.problems");
        const data = await response.json();
        if (data.status !== "OK") throw new Error("Failed to fetch problems");
        problemSet = data.result.problems;

        let html = `<table class="min-w-full border-collapse">
                      <thead>
                        <tr class="bg-gray-700">
                          <th class="px-4 py-2 border border-gray-600">Select</th>
                          <th class="px-4 py-2 border border-gray-600">Problem Name</th>
                          <th class="px-4 py-2 border border-gray-600">Contest ID</th>
                          <th class="px-4 py-2 border border-gray-600">Index</th>
                          <th class="px-4 py-2 border border-gray-600">Rating</th>
                          <th class="px-4 py-2 border border-gray-600">Tags</th>
                        </tr>
                      </thead>
                      <tbody>`;
        problemSet.forEach(problem => {
          const key = `${problem.contestId}-${problem.index}`;
          html += `
            <tr class="hover:bg-gray-700">
              <td class="px-4 py-2 border border-gray-600 text-center">
                <input type="checkbox" class="problem-checkbox" data-key="${key}">
              </td>
              <td class="px-4 py-2 border border-gray-600">
                <a href="https://codeforces.com/problemset/problem/${problem.contestId}/${problem.index}" target="_blank" class="text-blue-400 hover:underline">
                  ${problem.name}
                </a>
              </td>
              <td class="px-4 py-2 border border-gray-600">${problem.contestId}</td>
              <td class="px-4 py-2 border border-gray-600">${problem.index}</td>
              <td class="px-4 py-2 border border-gray-600">${problem.rating || "N/A"}</td>
              <td class="px-4 py-2 border border-gray-600">${problem.tags.join(", ")}</td>
            </tr>`;
        });
        html += `</tbody></table>`;
        container.innerHTML = html;
        
        const checkboxes = document.querySelectorAll(".problem-checkbox");
        checkboxes.forEach(cb => {
          cb.addEventListener("change", function() {
            const key = this.getAttribute("data-key");
            if (this.checked) {
              selectedProblems.add(key);
            } else {
              selectedProblems.delete(key);
            }
          });
        });
      } catch (err) {
        container.innerHTML = `<p class="text-red-500">Error loading problems: ${err.message}</p>`;
        console.error(err);
      }
    }
    
    function createContest() {
      const messageEl = document.getElementById("message");
      if (selectedProblems.size === 0) {
        messageEl.textContent = "Please select at least one problem.";
        messageEl.className = "mt-4 text-center text-red-500";
        return;
      }
      const selected = problemSet.filter(problem => {
        const key = `${problem.contestId}-${problem.index}`;
        return selectedProblems.has(key);
      });
      localStorage.setItem("contestRoomProblems", JSON.stringify(selected));
      messageEl.textContent = "Contest created successfully! Redirecting...";
      messageEl.className = "mt-4 text-center text-green-400";
      // Redirect to contest room page after 1 second.
      setTimeout(() => {
        window.location.href = "contestRoom.html";
      }, 1000);
    }
    
    document.getElementById("loadProblemsBtn").addEventListener("click", loadProblems);
    document.getElementById("createContestBtn").addEventListener("click", createContest);
  </script>
</body>
</html>
